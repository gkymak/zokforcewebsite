<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZOKFORCE AI Assessment Tool</title>
    <!-- Consolidated stylesheet: single entry point -->
    <link rel="stylesheet" href="enhanced-recommendation-styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="zokforce-logo">
                <h1>ZOKFORCE</h1>
                <span class="logo-subtitle">Lead in Tech, Deliver Excellence</span>
            </div>
            <div class="nav-links">
                <a href="../../index.html#about">About</a>
                <a href="../../index.html#contact">Contact</a>
                <a href="../../index.html#services">Services</a>
            </div>
        </div>
    </nav>

    <!-- Welcome Section -->
    <section id="welcome" class="section active">
        <div class="container">
            <div class="welcome-header">
                <h1>AI Assessment Tool</h1>
                <p class="subtitle">Comprehensive evaluation framework to assess your organization's AI maturity across six critical pillars.</p>
                <p class="description">This professional assessment will provide actionable insights and recommendations for improvement.</p>
            </div>
            
            <div class="assessment-overview">
                <div class="overview-grid">
                    <div class="overview-item">
                        <div class="overview-icon" aria-hidden="true">
                            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" role="img">
                                <rect x="5" y="7" width="14" height="14" rx="2"></rect>
                                <rect x="9" y="3" width="6" height="4" rx="1"></rect>
                                <line x1="8" y1="11" x2="16" y2="11"></line>
                                <line x1="8" y1="15" x2="16" y2="15"></line>
                            </svg>
                        </div>
                        <h3>72 Questions</h3>
                        <p>Comprehensive assessment across all dimensions</p>
                    </div>
                    <div class="overview-item">
                        <div class="overview-icon" aria-hidden="true">
                            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" role="img">
                                <circle cx="12" cy="12" r="8"></circle>
                                <circle cx="12" cy="12" r="4"></circle>
                                <line x1="12" y1="2" x2="12" y2="6"></line>
                                <line x1="12" y1="18" x2="12" y2="22"></line>
                                <line x1="2" y1="12" x2="6" y2="12"></line>
                                <line x1="18" y1="12" x2="22" y2="12"></line>
                            </svg>
                        </div>
                        <h3>6 Pillars</h3>
                        <p>Critical areas of AI governance</p>
                    </div>
                    <div class="overview-item">
                        <div class="overview-icon" aria-hidden="true">
                            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" role="img">
                                <path d="M8 9c0-2 1.8-3 4-3s4 1 4 3c0 1.2-.8 2-2 2 1.2 0 2 .8 2 2 0 2-2 3-4 3s-4-1-4-3c0-1.2.8-2 2-2-1.2 0-2-.8-2-2z"></path>
                            </svg>
                        </div>
                        <h3>Smart Recommendations</h3>
                        <p>Priority actions based on 6 pillars of AI governance</p>
                    </div>
                    <div class="overview-item">
                        <div class="overview-icon" aria-hidden="true">
                            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" role="img">
                                <rect x="5" y="11" width="3" height="8" rx="1"></rect>
                                <rect x="10" y="8" width="3" height="11" rx="1"></rect>
                                <rect x="15" y="5" width="3" height="14" rx="1"></rect>
                                <line x1="4" y1="20" x2="20" y2="20"></line>
                            </svg>
                        </div>
                        <h3>Detailed Report</h3>
                        <p>Professional PDF report with actionable insights</p>
                    </div>
                </div>
            </div>

            <div class="pillars-preview">
                <h2>Assessment Pillars</h2>
                <div class="pillars-grid">
                    <div class="pillar-preview">
                        <h4>Transparency & Explainability</h4>
                        <p>AI decision documentation and interpretability</p>
                    </div>
                    <div class="pillar-preview">
                        <h4>Fairness & Non-Discrimination</h4>
                        <p>Bias detection and algorithmic fairness</p>
                    </div>
                    <div class="pillar-preview">
                        <h4>Privacy & Security</h4>
                        <p>Data protection and cybersecurity measures</p>
                    </div>
                    <div class="pillar-preview">
                        <h4>Accountability & Governance</h4>
                        <p>Governance structures and risk management</p>
                    </div>
                    <div class="pillar-preview">
                        <h4>Reliability & Safety</h4>
                        <p>Model validation and safety protocols</p>
                    </div>
                    <div class="pillar-preview">
                        <h4>Human Agency & Oversight</h4>
                        <p>Human control and oversight mechanisms</p>
                    </div>
                </div>
            </div>

            <div class="company-form-container">
                <form id="company-form" class="company-form">
                    <h2>Company Information</h2>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="companyName">Company Name</label>
                            <input type="text" id="companyName" name="companyName" required>
                        </div>
                        <div class="form-group">
                            <label for="contactName">Contact Person</label>
                            <input type="text" id="contactName" name="contactName" required>
                        </div>
                        <div class="form-group">
                            <label for="contactEmail">Email Address</label>
                            <input type="email" id="contactEmail" name="contactEmail" required>
                        </div>
                        <div class="form-group">
                            <label for="industry">Industry</label>
                            <select id="industry" name="industry" required>
                                <option value="">Select Industry</option>
                                <option value="Financial Services">Financial Services</option>
                                <option value="Healthcare">Healthcare</option>
                                <option value="Technology">Technology</option>
                                <option value="Manufacturing">Manufacturing</option>
                                <option value="Government">Government</option>
                                <option value="Education">Education</option>
                                <option value="Retail">Retail</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                    </div>
                    <button type="submit" class="start-btn">Start Assessment</button>
                </form>
            </div>
        </div>
    </section>

    <!-- Assessment Section -->
    <section id="assessment" class="section hidden">
        <div class="container">
            <div class="assessment-header">
                <div class="progress-container">
                    <div class="progress-bar">
                        <div id="progressFill" class="progress-fill"></div>
                    </div>
                    <div id="progressText" class="progress-text">Question 1 of 72 (0%)</div>
                </div>
            </div>

            <div id="question-container" class="question-container">
                <!-- Questions will be dynamically loaded here -->
            </div>

            <div class="navigation-buttons">
                <button id="back-btn" class="nav-btn secondary" onclick="previousQuestion()" style="display: none;">Previous</button>
                <button id="next-btn" class="nav-btn primary" onclick="nextQuestion()">Next</button>
            </div>
        </div>
    </section>

    <!-- Dashboard Section -->
    <section id="dashboard" class="section hidden">
        <div class="container">
            <!-- Header with Company Info -->
            <div class="dashboard-header">
                <div class="company-info">
                    <h1>AI Assessment Report</h1>
                    <div class="company-details">
                        <div class="detail-item">
                            <strong>Company:</strong> <span id="company-name-display"></span>
                        </div>
                        <div class="detail-item">
                            <strong>Contact:</strong> <span id="contact-name-display"></span>
                        </div>
                        <div class="detail-item">
                            <strong>Email:</strong> <span id="company-email-display"></span>
                        </div>
                        <div class="detail-item">
                            <strong>Industry:</strong> <span id="company-industry-display"></span>
                        </div>
                        <div class="detail-item">
                            <strong>Assessment Date:</strong> <span id="assessment-date"></span>
                        </div>
                    </div>
                </div>
                <div class="overall-score-container">
                    <div class="overall-score">
                        <div class="score-circle">
                            <span id="overall-score" class="score-number">0.0</span>
                            <span class="score-max">/4.0</span>
                        </div>
                        <div class="maturity-info">
                            <div class="maturity-level" id="maturity-level">Calculating...</div>
                            <div class="maturity-description">Overall AI Maturity</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Overall Risk Score Display -->
            <div id="overall-risk-score" class="risk-score-section">
                <!-- Risk score will be populated by JavaScript -->
            </div>

            <!-- Enhanced Priority Actions Section -->
            <div id="top-priorities" class="priorities-section">
                <!-- Enhanced priorities will be generated here by the recommendation engine -->
            </div>

            <!-- Charts Section -->
            <div class="charts-section">
                <div class="chart-container">
                    <canvas id="radarChart"></canvas>
                </div>
                <div class="chart-container">
                    <canvas id="barChart"></canvas>
                </div>
            </div>

            <!-- Pillar Cards -->
            <div class="pillars-section">
                <h2>Pillar Performance Overview</h2>
                <div id="pillar-cards" class="pillar-cards-container">
                    <!-- Pillar cards will be generated here -->
                </div>
            </div>

            <!-- Detailed Recommendations -->
            <div id="detailed-recommendations" class="recommendations-section">
                <!-- Detailed pillar recommendations will be generated here -->
            </div>

            <!-- Action Buttons -->
            <div class="action-buttons">
                <button id="generate-pdf" class="action-btn primary" onclick="generatePDF()">Generate PDF Report</button>
                <button id="restart-assessment" class="action-btn secondary">Restart Assessment</button>
                <button id="contact-consultant" class="action-btn accent" onclick="contactConsultant()">Contact ZOKFORCE Consultant</button>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer__content">
                <div class="footer__brand">
                    <h2 class="logo">ZOKFORCE</h2>
                    <p>Digital excellence, driven by AI for all</p>
                </div>
                <div class="footer__links">
                    <div class="footer__section">
                        <h4>Services</h4>
                        <ul>
                            <li><a href="../../index.html#services">AI Strategy & Consulting</a></li>
                            <li><a href="../../index.html#services">LLM Integration</a></li>
                            <li><a href="../../index.html#services">Smart Chatbots</a></li>
                            <li><a href="../../index.html#services">Process Automation</a></li>
                            <li><a href="../../index.html#services">Data Analytics</a></li>
                            <li><a href="../../index.html#services">Digital Twin Solutions</a></li>
                        </ul>
                    </div>
                    <div class="footer__section">
                        <h4>Company</h4>
                        <ul>
                            <li><a href="../../index.html#about">About Us</a></li>
                            <li><a href="../../index.html#case-studies">Case Studies</a></li>
                            <li><a href="../../index.html#blog">Insights</a></li>
                            <li><a href="../../index.html#contact">Contact</a></li>
                        </ul>
                    </div>
                    <div class="footer__section">
                        <h4>Connect</h4>
                        <ul>
                            <li><a href="mailto:service@zokforce.com">Email</a></li>
                            <li><a href="tel:+1-437-808-2160">Phone</a></li>
                            <li><a href="https://www.linkedin.com/company/zokforce/">LinkedIn</a></li>
                            <li><a href="#">Twitter</a></li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="footer__bottom">
                <div class="footer__bottom-content">
                    <p>&copy; 2025 ZOKFORCE. All rights reserved. | Privacy Policy | Terms of Service</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Enhanced PDF Generation Function -->
    <script>
        async function generatePDF() {
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF('p', 'mm', 'a4');
                
                // ZOKFORCE Brand Colors
                const colors = {
                    primaryBlue: [30, 58, 138],
                    lightBlue: [59, 130, 246], 
                    darkGray: [31, 33, 33],
                    lightGray: [119, 124, 124],
                    success: [16, 185, 129],
                    warning: [245, 158, 11],
                    danger: [239, 68, 68]
                };
                
                // Company and assessment details
                const companyName = (localStorage.getItem('companyName') || 'Your Organization').trim();
                const contactName = (localStorage.getItem('contactName') || 'Not specified').trim();
                const contactEmail = (localStorage.getItem('contactEmail') || 'Not specified').trim();
                const industry = (localStorage.getItem('industry') || 'Not specified').trim();
                const assessmentDate = localStorage.getItem('assessmentDate') || new Date().toLocaleDateString();
                
                // Pillar scores and overall
                const pillarScores = (typeof calculatePillarScores === 'function') ? calculatePillarScores() : {};
                const pillarEntries = Object.entries(pillarScores);
                const overallScore = pillarEntries.length > 0 
                    ? pillarEntries.reduce((sum, [, s]) => sum + s, 0) / pillarEntries.length 
                    : parseFloat(document.getElementById('overall-score')?.textContent || '0');
                
                const maturityLabel = pdfGetMaturityLevel(overallScore);
                const scoreColor = pdfGetScoreColor(overallScore, colors);
                
                // PAGE 1: COVER PAGE
                pdfDrawHeader(doc, colors, true);
                
                doc.setFontSize(28);
                doc.setFont('helvetica', 'bold');
                doc.setTextColor(...colors.primaryBlue);
                doc.text('AI ASSESSMENT', 105, 70, { align: 'center' });
                doc.text('COMPREHENSIVE REPORT', 105, 85, { align: 'center' });
                
                // Company Info Box
                doc.setFillColor(247, 250, 252);
                doc.rect(20, 100, 170, 60, 'F');
                doc.setDrawColor(...colors.lightBlue);
                doc.setLineWidth(0.5);
                doc.rect(20, 100, 170, 60);
                
                doc.setFontSize(14);
                doc.setFont('helvetica', 'bold');
                doc.setTextColor(...colors.darkGray);
                doc.text('COMPANY INFORMATION', 25, 115);
                
                doc.setFontSize(11);
                doc.setFont('helvetica', 'normal');
                doc.text(`Company Name: ${companyName}`, 25, 130);
                doc.text(`Contact Person: ${contactName}`, 25, 140);
                doc.text(`Industry: ${industry}`, 25, 150);
                doc.text(`Assessment Date: ${assessmentDate}`, 120, 130);
                doc.text(`Report Generated: ${new Date().toLocaleDateString()}`, 120, 140);
                
                // Score circle
                doc.setFillColor(...scoreColor);
                doc.circle(105, 200, 25, 'F');
                doc.setFillColor(255, 255, 255);
                doc.circle(105, 200, 20, 'F');
                
                doc.setFontSize(32);
                doc.setFont('helvetica', 'bold');
                doc.setTextColor(...scoreColor);
                doc.text((overallScore || 0).toFixed(1), 105, 207, { align: 'center' });
                
                doc.setFontSize(12);
                doc.setTextColor(...colors.darkGray);
                doc.text('OVERALL SCORE', 105, 240, { align: 'center' });
                doc.setFontSize(14);
                doc.setFont('helvetica', 'bold');
                doc.text(`${maturityLabel.toUpperCase()}`, 105, 252, { align: 'center' });
                
                // PAGE 2: EXECUTIVE SUMMARY
                doc.addPage();
                pdfDrawHeader(doc, colors);
                
                doc.setFontSize(18);
                doc.setFont('helvetica', 'bold');
                doc.setTextColor(...colors.primaryBlue);
                doc.text('EXECUTIVE SUMMARY', 20, 40);
                
                const levelColor = pdfGetScoreColor(overallScore, colors);
                doc.setFillColor(...levelColor);
                doc.rect(20, 50, 170, 8, 'F');
                doc.setFontSize(12);
                doc.setFont('helvetica', 'bold');
                doc.setTextColor(255, 255, 255);
                doc.text(`MATURITY LEVEL: ${maturityLabel.toUpperCase()} (${(overallScore || 0).toFixed(1)}/4.0)`, 22, 56);
                
                // Key Findings
                doc.setFontSize(14);
                doc.setFont('helvetica', 'bold');
                doc.setTextColor(...colors.darkGray);
                doc.text('KEY FINDINGS', 20, 75);
                
                doc.setFontSize(10);
                doc.setFont('helvetica', 'normal');
                const findings = pdfGetKeyFindings(pillarScores);
                let yPos = 85;
                findings.forEach(finding => {
                    doc.text(`• ${finding}`, 25, yPos);
                    yPos += 8;
                });
                
                // Add charts if available
                yPos += 10;
                doc.setFontSize(14);
                doc.setFont('helvetica', 'bold');
                doc.text('PILLAR PERFORMANCE OVERVIEW', 20, yPos);
                
                // Capture and add radar chart
                const radarCanvas = document.getElementById('radarChart');
                if (radarCanvas && typeof radarCanvas.toDataURL === 'function') {
                    const radarImgData = radarCanvas.toDataURL('image/png', 1.0);
                    doc.addImage(radarImgData, 'PNG', 20, yPos + 10, 80, 60);
                }
                
                // Capture and add bar chart
                const barCanvas = document.getElementById('barChart');
                if (barCanvas && typeof barCanvas.toDataURL === 'function') {
                    const barImgData = barCanvas.toDataURL('image/png', 1.0);
                    doc.addImage(barImgData, 'PNG', 110, yPos + 10, 80, 60);
                }
                
                // SELECTED QUESTIONS & ANSWERS moved to end of generatePDF
                

                
                // PAGE 4+: PRIORITY ACTION PLAN UI (HTML Snapshot)
                const priorityContainer = document.getElementById('top-priorities');
                if (priorityContainer) {
                    const sections = priorityContainer.querySelectorAll('.priority-section');
                    if (sections.length > 0) {
                        for (const section of sections) {
                            doc.addPage();
                            pdfDrawHeader(doc, colors);

                            // Title from UI section
                            doc.setFontSize(18);
                            doc.setFont('helvetica', 'bold');
                            doc.setTextColor(...colors.primaryBlue);
                            const rawSectionTitle = section.querySelector('h3')?.textContent?.trim() || 'PRIORITY ACTION PLAN';
                            const sectionTitle = pdfSanitizeText(rawSectionTitle);
                            doc.text(sectionTitle, 20, 40);

                            // Capture UI section using html2canvas
                            const canvas = await html2canvas(section, {
                                backgroundColor: '#ffffff',
                                scale: 2,
                                useCORS: true,
                                removeContainer: true
                            });
                            const imgData = canvas.toDataURL('image/png', 1.0);

                            // Fit image within page bounds
                            const pageWidth = 210;
                            const pageHeight = 297;
                            const headerHeight = 25; // matches pdfDrawHeader default
                            const footerHeight = 12; // matches pdfDrawFooter default
                            const topY = headerHeight + 35; // add extra spacing below title to avoid overlap

                            const maxWidthMm = 170; // keep margins
                            let imgWidthMm = maxWidthMm;
                            let imgHeightMm = canvas.height * (imgWidthMm / canvas.width);
                            const availableHeightMm = pageHeight - topY - footerHeight - 8; // padding before footer

                            if (imgHeightMm > availableHeightMm) {
                                imgHeightMm = availableHeightMm;
                                imgWidthMm = canvas.width * (imgHeightMm / canvas.height);
                            }

                            const x = (pageWidth - imgWidthMm) / 2; // center horizontally
                            doc.addImage(imgData, 'PNG', x, topY, imgWidthMm, imgHeightMm, undefined, 'FAST');

                            pdfDrawFooter(doc, colors);
                        }
                    }
                }

                // Footer for previous content page
                pdfDrawFooter(doc, colors);

                // PAGE LAST: SELECTED QUESTIONS & ANSWERS
                doc.addPage();
                pdfDrawHeader(doc, colors);
                doc.setFontSize(18);
                doc.setFont('helvetica', 'bold');
                doc.setTextColor(...colors.primaryBlue);
                doc.text('SELECTED QUESTIONS & ANSWERS', 20, 40);
                
                // Build answered entries from global assessmentItems and scores
                let answered = [];
                try {
                    if (Array.isArray(assessmentItems) && assessmentItems.length > 0 && scores && typeof scores === 'object') {
                        for (const item of assessmentItems) {
                            const level = scores[item.id];
                            if (typeof level === 'number') {
                                const choice = Array.isArray(item.choices)
                                    ? item.choices.find(c => Number(c.level) === Number(level))
                                    : null;
                                const ansTextRaw = choice && choice.text ? choice.text : `Level ${level}`;
                                answered.push({
                                    id: item.id,
                                    pillar: item.pillar || 'General',
                                    question: item.question || '',
                                    level: level,
                                    answerText: ansTextRaw
                                });
                            }
                        }
                    }
                } catch (e) {
                    console.warn('Error building Q&A list:', e);
                }
                
                doc.setFontSize(11);
                doc.setFont('helvetica', 'normal');
                doc.setTextColor(...colors.darkGray);
                let yPosQA = 50;
                const maxY = 285 - 12; // leave space for footer
                const contentWidth = 170;
                
                if (answered.length === 0) {
                    doc.text('No responses found. Please complete the assessment to include selected answers.', 20, yPosQA);
                } else {
                    for (const entry of answered) {
                        const qHeader = `${entry.id} | ${entry.pillar}`;
                        const qText = pdfSanitizeText(entry.question);
                        const aText = pdfSanitizeText(entry.answerText);
                        const qLines = doc.splitTextToSize(`${qHeader}: ${qText}`, contentWidth);
                        const aLines = doc.splitTextToSize(`Selected Answer (Level ${entry.level}): ${aText}`, contentWidth);
                        
                        // Calculate block height
                        const blockHeight = (qLines.length + aLines.length) * 5 + 6;
                        if (yPosQA + blockHeight > maxY) {
                            // Finish current page and start a new one
                            pdfDrawFooter(doc, colors);
                            doc.addPage();
                            pdfDrawHeader(doc, colors);
                            yPosQA = 40;
                            // Re-render title on continuation pages for clarity
                            doc.setFontSize(12);
                            doc.setFont('helvetica', 'bold');
                            doc.setTextColor(...colors.primaryBlue);
                            doc.text('SELECTED QUESTIONS & ANSWERS (continued)', 20, yPosQA);
                            yPosQA += 10;
                            doc.setFontSize(11);
                            doc.setFont('helvetica', 'normal');
                            doc.setTextColor(...colors.darkGray);
                        }
                        
                        // Render question
                        doc.setFont('helvetica', 'bold');
                        doc.text(qLines, 20, yPosQA);
                        yPosQA += qLines.length * 5;
                        
                        // Render answer
                        doc.setFont('helvetica', 'normal');
                        doc.text(aLines, 20, yPosQA);
                        yPosQA += aLines.length * 5 + 6;
                    }
                }
                
                pdfDrawFooter(doc, colors);

                // Save the PDF
                const safeCompany = companyName.replace(/[^a-z0-9]/gi, '_');
                const fileName = `ZOKFORCE_AI_Assessment_${safeCompany}_${new Date().toISOString().split('T')[0]}.pdf`;
                doc.save(fileName);
                
            } catch (error) {
                console.error('Error generating PDF:', error);
                alert('There was an error generating the PDF. Please try again.');
            }
        }

        // PDF Helper Functions
        function pdfDrawHeader(doc, colors, isFullHeader = false) {
            doc.setFillColor(...colors.primaryBlue);
            doc.rect(0, 0, 210, isFullHeader ? 35 : 25, 'F');
            
            doc.setFontSize(20);
            doc.setFont('helvetica', 'bold');
            doc.setTextColor(255, 255, 255);
            doc.text('ZOKFORCE', 20, isFullHeader ? 20 : 15);
            
            if (isFullHeader) {
                doc.setFontSize(12);
                doc.setFont('helvetica', 'normal');
                doc.text('AI CONSULTING EXCELLENCE', 20, 30);
            }
            
            doc.setFontSize(10);
            doc.text(new Date().toLocaleDateString(), 190, isFullHeader ? 20 : 15, { align: 'right' });
        }

        function pdfDrawFooter(doc, colors) {
            doc.setFillColor(...colors.lightGray);
            doc.rect(0, 285, 210, 12, 'F');
            doc.setFontSize(10);
            doc.setFont('helvetica', 'normal');
            doc.setTextColor(255, 255, 255);
            doc.text('ZOKFORCE AI Consulting | service@zokforce.com | www.zokforce.com', 105, 292, { align: 'center' });
        }

        function pdfGetScoreColor(score, colors) {
            if (score >= 3.5) return colors.success;
            if (score >= 2.5) return colors.lightBlue;
            if (score >= 1.5) return colors.warning;
            return colors.danger;
        }

        function pdfGetMaturityLevel(score) {
            if (score >= 3.5) return 'Industry Leadership';
            if (score >= 3.0) return 'Mature Implementation';
            if (score >= 2.0) return 'Developing Capabilities';
            return 'Foundation Required';
        }

        function pdfGetKeyFindings(pillarScores) {
            const entries = Object.entries(pillarScores);
            if (entries.length === 0) return ['Overall AI maturity score: unavailable'];
            
            const avgScore = entries.reduce((a, [, b]) => a + b, 0) / entries.length;
            const highest = entries.sort((a, b) => b[1] - a[1])[0];
            const lowest = entries.sort((a, b) => a[1] - b[1])[0];
            
            return [
                `Overall AI maturity score: ${avgScore.toFixed(1)}/4.0`,
                `Strongest pillar: ${highest[0]} (${highest[1].toFixed(1)}/4.0)`,
                `Priority improvement area: ${lowest[0]} (${lowest[1].toFixed(1)}/4.0)`
            ];
        }

        function contactConsultant() {
            const companyName = localStorage.getItem('companyName') || 'Your Organization';
            const contactEmail = localStorage.getItem('contactEmail') || '';
            const industry = localStorage.getItem('industry') || 'Not specified';
            
            const subject = encodeURIComponent(`AI Consultation Request - ${companyName}`);
            const body = encodeURIComponent(`Hello ZOKFORCE team,

I have completed the AI Assessment for ${companyName} and would like to discuss the results and potential consulting services.

Company: ${companyName}
Industry: ${industry}
Email: ${contactEmail}

Please contact me to schedule a consultation.

Best regards`);
            
            window.open(`mailto:service@zokforce.com?subject=${subject}&body=${body}`);
        }
    </script>

    <!-- Load the comprehensive recommendation engine and enhanced app scripts -->
    <script src="complete-recommendation-engine.js"></script>
    <script src="enhanced-app-updated.js"></script>

    <script>
      // Helper: sanitize text for PDF (remove emojis, smart quotes, non-ASCII)
      function pdfSanitizeText(text) {
          if (!text) return '';
          const replacements = { '“': '"', '”': '"', '’': "'", '‘': "'", '—': '-', '–': '-', '…': '...' };
          let t = String(text);
          // Remove emoji and symbol ranges (including surrogate pairs)
          t = t.replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g, '');
          // Replace common typographic characters
          for (const [k, v] of Object.entries(replacements)) {
              t = t.split(k).join(v);
          }
          // Normalize and strip remaining non-ASCII
          try { t = t.normalize('NFKD'); } catch (_) {}
          t = t.replace(/[^\x20-\x7E]/g, '');
          return t.replace(/\s+/g, ' ').trim();
      }
    </script>
</body>
</html>